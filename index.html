<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigiVault - Secure Banking</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script>
        function registerUser() {
            event.preventDefault();
            let first_name = document.getElementById("First_name").value;
            let last_name = document.getElementById("Last_name").value;
            let password = document.getElementById("Password").value;
            let gender = document.getElementById("Gender").value;
            let email_id = document.getElementById("Email_id").value;
            let address = document.getElementById("Address").value;
            let mobileNo = document.getElementById("mobile_no").value;

            let user = {
                firstName: first_name,
                lastName: last_name,
                password: password,
                gender: gender,
                emailId: email_id,
                address: address,
                activeFlag: "Y",
                adminFlag: "N",
                mobileNo: mobileNo
            };

            fetch("http://localhost:8080/api/v1/register", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(user)
            })
                .then(response => response.json())
    .then(data => {
        if (data.userId && data.password && data.accountNo) {
            document.getElementById("popupMessage").innerHTML = `
                <p><strong>User ID:</strong> ${data.userId}</p>
                <p><strong>Password:</strong> ${data.password}</p>
                <p><strong>Account Number:</strong> ${data.accountNo}</p>
                <p>Please note these details safely.</p>
            `;
            document.getElementById("successPopup").style.display = "block";
        } else {
            alert("Registration failed. Please try again.");
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Something went wrong during registration.");
    });
}
        function loginUser() {
            let userIdString = document.getElementById("user_id").value;
            let password = document.getElementById("password").value;
            let userId = Number(userIdString);
            let loginData = {
                userId: userId,
                password: password
            };

            console.log(loginData);

            fetch("http://localhost:8080/api/v1/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(loginData)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data)
                    if (data.status === "success") {
                        // alert("Login successful!");
                        userIdString = "";
                        password = "";
                        fetchAccounts(userId);

                    } else {
                        userIdString = "";
                        password = "";
                        alert("Invalid credentials. Please try again.");

                    }
                })
                .catch(error => {
                    userIdString = "";
                    password = "";
                    console.error("Error:", error);
                    alert("Error logging in. Please try again.");
                });
        }


        function fetchAccounts(userId) {


            fetch(`http://localhost:8080/api/v1/accounts/${userId}`, {
                method: 'GET',
                mode: 'cors',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }) // Call API
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    sessionStorage.setItem("apiData", JSON.stringify(data));
                    window.location.href = "Customerdashboard.html";
                })
                .catch(error => console.error("Error fetching accounts:", error));
        }

 </script>
</head>

<body>

    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <div class="logo-title">
                <img src="bank-logo.png" alt="DigiVault Logo" class="bank-logo">
                <h1>DigiVault</h1>
            </div>
        </div>

        <!-- Middle Section with Animation -->
        <div class="middle-section">
            <div class="working-animation">
                <img src="computer.gif" alt="Working computer animation" class="working-people">
            </div>
        </div>

        <!-- Login & Register Forms -->
        <div class="right-bar">
            <div class="form-container">
                <!-- Login Form -->
                <div id="loginForm" class="form-box">
                    <h2>Login</h2>
                    <form id="loginFormSubmit" onsubmit="event.preventDefault(); loginUser();">
                        <input type="number" id="user_id" placeholder="Customer ID" required>
                        <div style="position: relative;">
                            <input type="password" id="password" placeholder="Password" required style="padding-right: 40px;">
                            <span onclick="togglePassword()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">
                                üëÅÔ∏è
                            </span>
                        </div>
                        
                        <button type="submit" id="loginButton">Login</button>
                    </form>
                    <p><a href="#" id="forgotPasswordLink" onclick="handleForgotPassword()">Forgot Password?</a></p>
                    <p>Don't have an account? <a href="#" onclick="toggleForms()">Register</a></p>
                    <p>Admin Page: <a href="adminlogin.html">Admin Login</a></p>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="form-box hidden">
                    <h2>Register</h2>
                    <form id="registerFormSubmit" onsubmit=" registerUser(event);">
                        <div class="row">
                            <input type="text" id="First_name" placeholder="First Name" required>
                            <input type="text" id="Last_name" placeholder="Last Name" required>
                        </div>
                        <div class="row">
                            <select id="Gender" required>
                                <option value="" disabled selected>Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                            <input type="text" id="mobile_no" placeholder="Mobile Number" required>
                        </div>
                        <div class="row">
                            <input type="email" id="Email_id" placeholder="Email ID" required>
                        </div>
                        <input type="password" id="Password" placeholder="Enter AlphaNumeric Password" required
                            maxlength="30" oninput="validatePasswordInput(this)">
                        <div class="row">
                            <textarea id="Address" placeholder="Enter your address" rows="3" required></textarea>
                        </div>
                        <div class="submit-container">
                            <button type="submit" id="registerButton">Submit</button>
                        </div>
                    </form>
                    <p>Already have an account? <a href="#" onclick="toggleForms()">Login</a></p>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 DigiVault Banking System |
                <a href="terms.html">Terms & Conditions</a>
            </p>
        </footer>


        <!-- Success Popup -->
<div id="successPopup" class="popup-container hidden">
    <div class="popup-content">
        <h2>Registration Successful üéâ</h2>
        <div id="popupMessage"></div>    <!-- dynamic content will go here -->
        <button onclick="document.getElementById('successPopup').style.display='none'">OK</button>
    </div>
</div>

        <!-- <p class="forgot-password" onclick="openForgotPopup()">Forgot Password?</p> -->

        <!-- Step 1: Forgot Password Popup -->
        <div id="forgotPasswordPopup" class="popup-container hidden">
            <div class="popup-content">
                <h2>Forgot Password</h2>
                <p>Enter your registered Email ID to reset your password.</p>
                <input type="email" id="forgotEmail" placeholder="Enter your User ID" required>
                <button onclick="nextStep()">Next</button>
                <button onclick="closeForgotPopup()">Cancel</button>
            </div>
        </div>

        <!-- Step 2: Mobile & Email Verification Popup -->
        <div id="verificationPopup" class="popup-container hidden">
            <div class="popup-content">
                <h2>Verify Your Identity</h2>
                <p>Enter your registered Mobile Number and Email ID.</p>
                <input type="text" id="mobileNon" placeholder="Enter your Mobile Number" required>
                <input type="email" id="emailIdn" placeholder="Enter your Email ID" required>
                <button onclick="sendPasswordResetNew()">Submit</button>
                <button onclick="closeVerificationPopup()">Cancel</button>
            </div>
        </div>

        <!-- Step 3: Confirmation Message Popup -->
        <div id="confirmationPopup" class="popup-container hidden">
            <div class="popup-content">
                <h2>Success!</h2>
                <p>Password reset link has been sent to your registered email ID.</p>
                <button onclick="closeConfirmationPopup()">OK</button>
            </div>
        </div>
    </div>
    <script>
    function sendPasswordResetNew() {
    const email = document.getElementById("emailIdn").value;
    const mobile = document.getElementById("mobileNon").value;
    console.log(email);
    console.log(mobile);

    fetch("http://localhost:8080/api/v1/verify-user", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: email, mobile: mobile })
    })
    .then(response => {
        if (response.ok) {
            alert("Email has been sent to the registered Email Id");
            document.getElementById("verificationPopup").classList.add("hidden");
            document.getElementById("confirmationPopup").classList.remove("hidden");
        } else {
            alert("Invalid email or mobile number.");
        }
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Something went wrong.");
    });
}

</script>
    <script src="script.js"></script>

    <script>
        function toggleForms() {
            document.getElementById("loginForm").classList.toggle("hidden");
            document.getElementById("registerForm").classList.toggle("hidden");
        }

        function handleForgotPassword() {
            document.getElementById("forgotPasswordPopup").style.display = "block";
        }

        function closeForgotPopup() {
            document.getElementById("forgotPasswordPopup").style.display = "none";
        }

        function sendPasswordReset() {
            let email = document.getElementById("verifyEmail").value;
            if (email.trim() === "") {
                alert("Please enter your registered Email ID.");
                return;
            }
            alert("A password reset link has been sent to " + email);
            window.location.href = "index.html";
        }

        document.getElementById("registerFormSubmit").addEventListener("submit", function (event) {
            event.preventDefault();
            var password = document.getElementById("Password").value;
            var alphanumericRegex = /[a-zA-Z0-9]+/g;
            if (password.length > 30) {
                alert("Password must be less than 30 characters long.");
                return;
            } else if (!alphanumericRegex.test(password)) {
                alert("Password must be less than 30 characters long and contain both letters and numbers.");
                return;
            
            }
        });

    </script>
</body>
</html>